<!DOCTYPE html>
<html>
    <head>
        <style>
            main {
                display: grid;
                gap: 1rem;
                /* grid-template-columns: repeat(6, 1fr); */
                grid-template-columns: "choices" "answer";
                justify-items: center;

                margin: 1rem;
            }

            .choice {
                width: 10rem;
                height: 10rem;
            }

            #choices {
                grid-area: "choices";
                
                display: flex;
                gap: 6rem;
            }

            #answer {
                grid-area: "answer";
            }
        </style>

        <script type="module">

        </script>

        <!-- <script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script> -->

        <script>
            // Created by: https://stackoverflow.com/questions/3665115/how-to-create-a-file-in-memory-for-user-to-download-but-not-through-server#answer-18197341
            // Modified by: Jake D'Esposito
            function downloadData() {
                const filename = "data.json"
                const text = document.cookie
                
                var element = document.createElement('a')
                element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text))
                element.setAttribute('download', filename)

                element.style.display = 'none'
                document.body.appendChild(element)

                element.click()

                document.body.removeChild(element)
            }

            // https://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb#answer-5624139
            function rgbToHex(r, g, b) {
                return "#" + (1 << 24 | r << 16 | g << 8 | b).toString(16).slice(1);
            }

        </script>
    </head>
    <body>
        <button onclick="downloadData()">Download Data</button>

        <main>
            <section id="choices">
                <div class="choice"></div>
                <div class="choice"></div>
            </section>
            <div class="choice" id="answer"></div>

            <script type="module">
                import Cookies from 'https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/+esm'

                let choicesCounter = 0
                const cookieChoice = (obj) => Cookies.set(choicesCounter++, JSON.stringify(obj))

                const { random } = Math

                const colors = [
                    "#ff0c00",
                    "#5d5700",
                    "#027752",
                    "#ffff00",
                    "#4200ff",
                    "#800063"
                ]

                const choicesElement  = document.getElementById("choices")
                const answerElement = document.getElementById("answer")

                let choice1, choice2, answer, startTime

                function choiceSelected ( choice ) {
                    // TODO: Get end time and use it.
                    cookieChoice({
                        choice,
                        correct: choice === answer,
                        duration: Date.now() - startTime
                    })
                    const firstChoice = choicesElement.children[0]
                    const secondChoice = choicesElement.children[1]
                    firstChoice.style.backgroundColor = secondChoice.style.backgroundColor = answerElement.style.backgroundColor = "white"
                    firstChoice.onclick = secondChoice.onclick = () => {}

                    createNewChoices()
                }
                const randomRanged = (max, min) => Math.floor( Math.random() * ( max - min + 1 ) + min )

                function createChoices () {
                    choice1 = randomRanged(0, colors.length - 1)
                    choice2 = randomRanged(0, colors.length - 1)
                    while(choice1 === choice2)
                        choice2 = randomRanged(0, colors.length - 1)

                    // console.log({ choice1, choice2 })

                    answer = random() > 0.5 ? choice1 : choice2
                }

                const createNewChoices = () => setTimeout(() => {
                    createChoices()

                    const firstChoice = choicesElement.children[0]
                    firstChoice.style.backgroundColor = colors[choice1]
                    firstChoice.onclick = () => choiceSelected( choice1 )

                    const secondChoice = choicesElement.children[1]
                    secondChoice.style.backgroundColor = colors[choice2]
                    secondChoice.onclick = () => choiceSelected( choice2 )

                    answerElement.style.backgroundColor = colors[answer]

                    startTime = Date.now()
                }, 1000)
                createNewChoices()
            </script>
        </main>

        <!-- <main>
            <div style="background-color: #ff0c00;"></div>
            <div style="background-color: #5d5700;"></div>
            <div style="background-color: #027752;"></div>
            <div style="background-color: #ffff00;"></div>
            <div style="background-color: #4200ff;"></div>
            <div style="background-color: #800063;"></div>
        </main> -->

    </body>
</html>